<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="layout">
<body>

<th:block layout:fragment="content">
  <h2>Product</h2>
  <form th:action="@{/products}" method="post" id="product-create-form" th:object="${product}">
    <p th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></p>
    <label>name
      <input th:field="*{name}"/>
    </label><br/>
    <p th:if="${#fields.hasErrors('url')}" th:errors="*{url}"></p>
    <label>url
      <input th:field="*{url}"/>
    </label><br/>
    <button type="submit">作成(x-www-form-urlencoded)</button>
    |
    <button type="button" id="product-create-submit">作成(json)</button>
  </form>
  <table>
    <thead>
    <tr>
      <th>id</th>
      <th>name</th>
      <th></th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="o : ${productList}">
      <td th:text="${o.id}"></td>
      <td th:text="${o.name}"></td>
      <td><a th:href="@{/products/{productId}(productId=${o.id})}">show</a> | <a
          th:href="@{/products/{productId}.json(productId=${o.id})}">json</a></td>
    </tr>
    </tbody>
  </table>
</th:block>

<th:block layout:fragment="js">
  <script>
    $(function () {
      var $form = $('#product-create-form');

      $("#product-create-submit").on('click', function () {
        var o = createObjectFromForm($form);

        $.ajax({
          url: $form.attr('action'),
          data: JSON.stringify(o),
          method: 'POST',
          contentType: 'application/json'
        })
      });
    });

    function createObjectFromForm($form) {
      var o = {};
      $form.find('input').each(function (index, input) {
        o[input.getAttribute('name')] = input.value;
      });

      return o;
    }
  </script>
</th:block>
</body>
</html>
